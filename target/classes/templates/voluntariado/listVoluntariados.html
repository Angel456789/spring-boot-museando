<!doctype html>
<html lang="es">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Plataforma interactiva de experiencias culturales con tecnología IoT">
	<meta name="author" content="TuNombre">

	<title>Lista Voluntariados</title>

	<link rel="icon" href="favicon.ico">
	<link
		href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
		rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
	<link th:href="@{/css/estilos.css}" rel="stylesheet">
	<link th:href="@{/css/listas.css}" rel="stylesheet">
</head>

<body>
	<div class="d-flex flex-column min-vh-100">
		<!-- Barra de navegación -->
		<header th:insert="~{fragmentos/menu :: menu-principal}"></header>

		<!-- Contenido principal -->
		<main class="container my-5">
			<div class="lista-contenedor">
				<div class="lista-header">
					<h2><i class="fas fa-hands-helping me-2"></i>Gestión de Solicitudes de Voluntariado</h2>
				</div>

				<div class="lista-toolbar mb-3">
					<a th:href="@{/voluntariado/lista}"
						th:classappend="${filtroEstado == null} ? ' btn-lista-active' : ''"
						class="btn-lista btn-lista-primary me-2">
						<i class="fas fa-filter me-1"></i> Todos
					</a>
					<a th:href="@{/voluntariado/lista(estado='PENDIENTE')}"
						th:classappend="${filtroEstado == 'PENDIENTE'} ? ' btn-lista-active' : ''"
						class="btn-lista btn-lista-warning me-2">
						Pendientes
					</a>

					<a th:href="@{/voluntariado/lista(estado='ACEPTADO')}"
						th:classappend="${filtroEstado == 'ACEPTADO'} ? ' btn-lista-active' : ''"
						class="btn-lista btn-lista-success me-2">
						Aceptados
					</a>
					<a th:href="@{/voluntariado/lista(estado='RECHAZADO')}"
						th:classappend="${filtroEstado == 'RECHAZADO'} ? ' btn-lista-active' : ''"
						class="btn-lista btn-lista-danger">
						Rechazados
					</a>
				</div>

				<div th:if="${mensaje}" class="alert" th:classappend="${alertClass}" role="alert" >
				    <span th:text="${mensaje}"></span>
				</div>


				<table class="tabla-listado">
					<thead>
						<tr>
							<th width="80">ID</th>
							<th>Nombre</th>
							<th>Usuario</th>
							<th>Museo</th>
							<th>Recibida</th>
							<th>Estado</th>
							<th width="220" class="text-center">Operaciones</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="voluntariado : ${voluntariados}">
							<td th:text="${voluntariado.id}"></td>
							<td><strong th:text="${voluntariado.usuario.nombre}"></strong></td>
							<td><strong th:text="${voluntariado.usuario.username}"></strong></td>
							<td th:text="${voluntariado.museo.nombre}"></td>
							<td th:text="${voluntariado.fecha}"></td>
							<td>
								<span th:switch="${voluntariado.estado.toString()}">
									<span th:case="'ACEPTADO'" class="badge bg-success">Aceptado</span>
									<span th:case="'RECHAZADO'" class="badge bg-danger">Rechazado</span>
									<span th:case="'PENDIENTE'" class="badge bg-warning text-dark">Pendiente</span>
									<span th:case="*" class="badge bg-secondary">Desconocido</span>
								</span>
							</td>
							<td class="text-center">
								<div class="d-flex justify-content-center flex-wrap gap-2">

									<!-- Grupo 1: Descargar y enviar correo -->
									<div>
										<a th:href="@{/voluntariado/descargar(id=${voluntariado.id})}"
											class="btn btn-info btn-sm" title="Descargar archivo">
											<i class="fas fa-download"></i>
										</a>

										<a th:href="@{/voluntariado/formGmail(idUsuario=${voluntariado.usuario.id})}"
											class="btn btn-primary btn-sm" title="Enviar correo">
											<i class="fas fa-envelope"></i>
										</a>
									</div>

									<!-- Grupo 2: Aceptar y rechazar -->
									<!-- Grupo 2: Aceptar y rechazar -->
									<div>
									    <!-- Botón Aceptar: verde (btn-success) -->
									    <a th:href="@{/voluntariado/cambiarEstado(id=${voluntariado.id}, nuevoEstado='ACEPTADO')}"
									       class="btn btn-success btn-sm" title="Aceptar solicitud">
									       <i class="fas fa-check"></i>
									    </a>

									    <!-- Botón Rechazar: amarillo (btn-warning) -->
									    <a th:href="@{/voluntariado/cambiarEstado(id=${voluntariado.id}, nuevoEstado='RECHAZADO')}"
									       class="btn btn-warning btn-sm" title="Rechazar solicitud">
									       <i class="fas fa-times"></i>
									    </a>

									    <!-- Botón Eliminar: rojo (btn-danger) -->
									    <a th:href="@{/voluntariado/eliminar(id=${voluntariado.id})}" 
									       class="btn btn-danger btn-sm confirmar" 
									       title="Eliminar solicitud">
									       <i class="fas fa-trash-alt"></i>
									    </a>
									</div>
								</div>
							</td>

						</tr>
					</tbody>
				</table>
			</div>
		</main>

		<!-- Footer -->
		<footer class="footer" th:insert="~{fragmentos/pie :: pie-pagina}"></footer>
	</div>

	<!-- Bootstrap JS y confirmación -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
	  document.querySelectorAll('.confirmar').forEach(function (el) {
	    el.addEventListener('click', function (e) {
	      e.preventDefault(); // evitar que se siga el enlace inmediatamente

	      const href = el.getAttribute('href');

	      Swal.fire({
	        title: '¿Estás seguro?',
	        text: 'Se eliminará esta solicitud de voluntariado. Esta acción no se puede deshacer.',
	        icon: 'warning',
	        showCancelButton: true,
	        confirmButtonColor: '#d33',
	        cancelButtonColor: '#3085d6',
	        confirmButtonText: 'Sí, eliminar',
	        cancelButtonText: 'Cancelar'
	      }).then((result) => {
	        if (result.isConfirmed) {
	          // Si confirma, redirige a la URL para eliminar
	          window.location.href = href;
	        }
	      });
	    });
	  });
	</script>

</body>

</html>